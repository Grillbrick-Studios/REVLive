function rlightbox(e,o,t){void 0===t&&(t=0);var r,i="",n=document.createElement("DIV");switch(e){case"note":r="/myrevnotes.php?loc="+o+"&edt="+t;break;case"enote":r="/editnote.php?loc="+o;break;case"pnote":r="/peernote.php?loc="+o;break;case"keys":r="/myrevkeys.php";break;case"tut":r="/myrevtutorial.php";break;default:alert("I'm lost")}n.id="lightbox",n.onclick=function(){try{this.children[0].children[0].children[0].contentWindow.olClose()}catch(e){}},i='<div id="resdiv" style="position:relative;top:50%;transform:translateY(-50%);height:90%;overflow:hidden;width:90%;max-width:1024px;left:0;right:0;margin:auto;padding:0 10px;background-color:'+colors[2]+";border:1px solid "+colors[6]+';border-radius:8px;">',i+='<div style="position:relative;height:100%;overflow-x:hidden;overflow-y:scroll;z-index:88;">',i+='<iframe src="'+r+'" frameborder="0" allowfullscreen style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:88;min-height:440px;"></iframe>',i+="</div>",i+="</div>",n.innerHTML=i,n.style.zIndex=99,document.body.appendChild(n),n.style.transition="opacity .5s",setTimeout("rlbfadein();",1)}function rlbfadein(){document.getElementById("lightbox").style.opacity=1}function rlbfadeout(){document.getElementById("lightbox").style.opacity=0,setTimeout("closerlb()",800)}function closerlb(){var e=document.getElementById("lightbox");e.parentNode.removeChild(e)}function savemyrevprefs(){var e=myrevmode+";"+myrevsort+";"+myrevpagsiz+";"+myrevshownotes+";"+myrevclick+";"+ednotesshowall+";"+myrevshowkey+";"+myrevshoweditorfirst+";"+viewedcomments+";"+viewmrcomments+";"+peernotesshowall+";"+viewpeernotes;setCookie("rev_myrevprefs",e,cookieexpiredays)}function setmyrevmode(e){myrevmode=e,savemyrevprefs()}function setedcomments(e){viewedcomments=e,savemyrevprefs()}function setpeernotes(e){viewpeernotes=e,savemyrevprefs()}function setpeernotesshowall(e){peernotesshowall=e,savemyrevprefs()}function setednotesshowall(e){ednotesshowall=e,savemyrevprefs()}function setmrcomments(e){viewmrcomments=e,savemyrevprefs()}function setmyrevsort(e){myrevsort=e,savemyrevprefs()}function setmyrevpagsiz(e){myrevpagsiz=e,savemyrevprefs()}function setmyrevshownotes(e){myrevshownotes=e,savemyrevprefs()}function setmyrevclick(e){myrevclick=e,savemyrevprefs()}function setmyrevshowkey(e){myrevshowkey=e,savemyrevprefs()}function setmyrevshoweditorfirst(e){myrevshoweditorfirst=e,savemyrevprefs()}var myrevcheckPosTimeout,gbmstr,gqry,grefr,gbmktimeout;function myrevhandlemouseover(){myrevclearPositionTimer()}function myrevhandlemouseout(){myrevstartPositionTimer()}function myrevstartPositionTimer(e){void 0===e&&(e=100),myrevcheckPosTimeout=setTimeout("myrevhidePopup()",e)}function myrevclearPositionTimer(){clearTimeout(myrevcheckPosTimeout),myrevcheckPosTimeout=null}function myrevhidePopup(e){void 0===e&&(e="myrevdiv");try{$(e).style.opacity=0,setTimeout("$('"+e+"').style.display = 'none'",400)}catch(e){}}function initmyrevpopup(e){myrev={divmyrev:document.createElement("div")},document.body.appendChild(myrev.divmyrev),myrev.divmyrev.id=e,myrev.divmyrev.style.position="absolute",myrev.divmyrev.style.display="none",myrev.divmyrev.style.zIndex=89,myrev.divmyrev.style.opacity=0,myrev.divmyrev.style.transition=".4s",myrev.divmyrev.style.whiteSpace="nowrap",myrev.divmyrev.style.backgroundColor=colors[2],myrev.divmyrev.style.padding="6px 6px 2px 6px",myrev.divmyrev.style.border="1px solid "+colors[1],myrev.divmyrev.style.borderRadius="4px",myrev.divmyrev.style.boxShadow="0 3px 5px rgba(50,50,50,0.5)",myrev.divmyrev.innerHTML=""}function gethilightdivcontents(e,o,t,r,i,n,s,l,a,m){var c="";if(""!=t){var d=t.split("/"),p=e.split("|"),y=d[1]+" "+d[2]+(p[1]<2?":"+d[3]:""),v=p[0];try{sizenavto(0)}catch(e){}try{hvmrnot=$("mrimg_"+e).getAttribute("data-havemrnote")}catch(e){hvmrnot=0}try{isbmked=$("mrimg_"+e).getAttribute("data-isbmked")}catch(e){isbmked=0}c='<span style="display:inline-block;position:relative;width:100%;text-align:center;font-size:90%;font-weight:bold;padding:2px 0;"><a href="/myrev" class="comlink0" style="cursor:default;">'+y+"</a>";var h=page+"|"+p[1]+"|"+p[2]+"|"+p[3]+"|"+(0==page?"nav":"")+p[4];c+='<a id="bmk" style="display:inline-block;position:absolute;top:1px;right:3px;" onclick="'+(0==isbmked?"add":"del")+'bookmark();" ',y+=5==page?" commentary":"",c+='title="'+(1==isbmked?y+" is bookmarked.":"Click to bookmark "+y+".")+'"><img id="bmkimg" src="/i/mnu_bookmarks'+(1==isbmked?"_FILL":"")+colors[0]+'.png" alt="bookmarks" style="height:18px;" /></a>',gbmstr=h,gqry=e,grefr=y,c+="</span><br />",1==d[4]&&(t="/"+d[1]+"/"+d[2]+"/"+d[3],c+='<div style="white-space:nowrap;border-bottom:1px solid '+colors[3]+';margin-top:6px;margin-bottom:4px;">',c+='<span style="display:inline-block;"><a href="'+t.replace(" ","-")+'" title="REV Commentary" target="'+(1==prfcommnewtab?"_blank":"_self")+'"><img src="/i/myrev_commentary'+colors[0]+(1==r?"_DOT":"")+'.png" style="width:2.5em;margin:0 4px 0px 4px;" alt="REV Commentary" /></a></span>',c+="<span style=\"display:inline-block;\"><a onclick=\"rlightbox('note','"+e+'\');myrevhidePopup();" title="My Notes on '+y+'"><img src="/i/myrev_notes'+colors[0]+(1==hvmrnot?"_DOT":"")+'.png" style="width:2.5em;margin:0 5px 0 8px;" alt="edit" /></a></span>',c+="<span style=\"display:inline-block;\"><a onclick=\"rlightbox('note','"+v+'|0|0|0|0\');myrevhidePopup();" title="My Workspace"><img src="/i/myrev_workspace'+colors[0]+(1==i?"_DOT":"")+'.png" style="width:2.5em;margin:0 3px 0 3px;" alt="edit" /></a></span>',c+="</div>")}c+='<div id="pallete">',1==myrevshowkey?c+=handlecolors(e,o,0,n):c+=handlecolorsnocap(e,o,0,n),c+="</div>",c+='<div style="overflow:hidden;">',c+='<span style="display:'+(1==myrevshowkey?"inline-block":"none")+';float:left;margin-left:3px;" id="dolabels"><a onclick="rlightbox(\'keys\',\'\');" title="edit captions"><img src="/i/myrev_editkeys'+colors[0]+'.png" style="width:.7em;margin-bottom:-2px;" alt="Edit Captions" /></a></span>',c+='<span style="display:inline-block;float:right;"><a onclick="changepallete(\''+e+"',"+o+",0,"+n+')" title="legend" class="comlink0" style="color:'+colors[7]+';"><span id="legend" style="margin-right:4px;">'+(1==myrevshowkey?"&laquo;":"&raquo;")+"</span></a></span>",c+="</div>";var k=0;if(1==a&&peernotes>0&&1==viewpeernotes){try{hvprnot=$("peerimg_"+e).getAttribute("data-havepeernote")}catch(e){hvprnot=0}1==hvprnot||1==canaddpeernote?pnonclick="rlightbox('pnote','"+e+"',1)":pnonclick="alert('Sorry, you do not have permission\\nto add a reviewer note to this book.')",c+='<hr style="margin:0 0 2px 0;padding:0" />',c+='<span  style="display:inline-block;margin-top:4px;"><a class="comlink0" style="color:'+colors[7]+';font-size:92%;" href="/pnotes"><small>Review<br />notes</small></a></span>',c+='<span style="display:inline-block;float:right;"><a onclick="rlightbox(\'pnote\',\'-1|0|0|0|0\',1);myrevhidePopup();" title="Reviewer Workspace"><img src="/i/peer_workspace'+colors[0]+(1==m?"_YELDOT":"")+'.png" style="width:2.5em;margin:0 4px 0 3px;" alt="edit" /></a></span>',c+='<span style="display:inline-block;float:right;"><a onclick="'+pnonclick+';myrevhidePopup();" title="Reviewer Note"><img src="/i/peer_notes'+colors[0]+(1==hvprnot?"_YELDOT":"")+'.png" style="width:2.5em;margin:0 5px 0 8px;" alt="edit" /></a></span>',k=1}if(1==s&&1==editorcomments&&1==viewedcomments){try{hvednot=$("edimg_"+e).getAttribute("data-haveednote")}catch(e){hvednot=0}c+='<hr style="margin:'+(1==k?"6px":"0")+' 0 2px 0;padding:0" />',c+='<span  style="display:inline-block;margin-top:4px;"><a class="comlink0" style="color:'+colors[7]+';font-size:92%;" href="/enotes"><small>Editor<br />notes</small></a></span>',c+='<span style="display:inline-block;float:right;"><a onclick="rlightbox(\'enote\',\'-1|0|0|0|0\',1);myrevhidePopup();" title="Editor Workspace"><img src="/i/editor_workspace'+colors[0]+(1==l?"_REDDOT":"")+'.png" style="width:2.5em;margin:0 4px 0 3px;" alt="edit" /></a></span>',c+="<span style=\"display:inline-block;float:right;\"><a onclick=\"rlightbox('enote','"+e+'\',1);myrevhidePopup();" title="Editor Note"><img src="/i/editor_notes'+colors[0]+(1==hvednot?"_REDDOT":"")+'.png" style="width:2.5em;margin:0 5px 0 8px;" alt="edit" /></a></span>'}return c}function addbookmark(){var e=decodeURIComponent(getCookie("rev_bookmarks")),o=gbmstr.split("|");e=o[0]+","+o[1]+","+o[2]+","+o[3]+","+(0==o[0]&&o[4]>0?"nav":"")+o[4]+(""==e?"":";")+e,e=checknumbmks(e),setCookie("rev_bookmarks",e,cookieexpiredays),$("bmk").onclick=delbookmark,$("mrimg_"+gqry).setAttribute("data-isbmked",1),$("bmkimg").src="/i/mnu_bookmarks_FILL"+colors[0]+".png",$("bmk").title="Click to un-bookmark "+grefr,reloadBookmarks(page,1),dobiblenav("navmitm=10&notification='"+grefr+" has been bookmarked.'"),gbmktimeout=setTimeout("sizenavto(0);",2500)}function delbookmark(){if(confirm("Delete the bookmark for\n"+grefr+"?")){var e=gbmstr.replace(/\|/g,","),o=decodeURIComponent(getCookie("rev_bookmarks"))+";";o=(o=o.replace(e+";","")).substring(0,o.length-1),setCookie("rev_bookmarks",o,cookieexpiredays),$("bmk").onclick=addbookmark,$("mrimg_"+gqry).setAttribute("data-isbmked","0"),$("bmkimg").src="/i/mnu_bookmarks"+colors[0]+".png",$("bmk").title="Click to bookmark "+grefr,reloadBookmarks(page,1),dobiblenav("navmitm=10&notification='"+grefr+" has been removed.'"),gbmktimeout=setTimeout("sizenavto(0);",2500)}}function handlecolors(e,o,t,r){for(var i="",n=0;n<hlcolors.length;n++)i+='<span style="display:inline-block;width:144px;height:20px;border:'+(o==n?"1px solid red":"1px solid "+colors[3])+";border-radius:4px;",i+="color:"+colors[7]+";background-color:"+hlcolors[n]+';font-size:70%;cursor:pointer;margin:1px 4px;padding:8px 2px 0 2px;" ',i+='onclick="do'+(1==t?"local":"")+"hilight('"+e+"',"+n+","+r+');" />'+myrevkeys[n]+"</span><br />\n";return i}function handlecolorsnocap(e,o,t,r){for(var i="",n=0;n<hlcolors.length;n++)i+='<span style="display:inline-block;width:40px;height:40px;border:'+(o==n?"1px solid red":"1px solid "+colors[3])+";border-radius:4px;background-color:"+hlcolors[n]+";cursor:pointer;margin:4px"+(n>2?" 4px 1px 4px":"")+';"',i+=' onclick="do'+(1==t?"local":"")+"hilight('"+e+"',"+n+","+r+');" title="'+myrevkeys[n]+'" />&nbsp;</span>'+(2==n?"<br />":"")+"\n";return i}function changepallete(e,o,t,r){myrevshowkey=1-myrevshowkey,setmyrevshowkey(myrevshowkey);var i=document.getElementById("pallete"),n=document.getElementById("legend"),s=document.getElementById("dolabels");1==myrevshowkey?i.innerHTML=handlecolors(e,o,t,r):i.innerHTML=handlecolorsnocap(e,o,t,r),n.innerHTML=1==myrevshowkey?"&laquo;":"&raquo;",s.style.display=1==myrevshowkey?"inline-block":"none"}function gethilightdivcoords(e){var o=window.innerWidth,t=window.scrollY+window.innerHeight,r=cursorX+12;r+16+e.clientWidth>=o&&(r=o-e.clientWidth-16);var i=getCursorY()+12;return i+e.clientHeight>t&&(i=i-e.clientHeight-20),{left:r,top:i}}function dohilight(e,o,t){null==t&&(t=0);var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){for(var e=JSON.parse(r.responseText),i=document.getElementsByClassName(e.spanclass),n=0;n<i.length;n++)i[n].style.backgroundColor=e.color,i[n].setAttribute("data-hlite",o),i[n].title=myrevkeys[o],1==t&&(i[n].innerHTML=myrevkeys[o]+"&nbsp;");myrevhidePopup()}},r.open("GET","/jsonmyrevtasks.php?task=hlit&ref="+e+"|"+o,!0),r.send()}