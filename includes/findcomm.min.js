var findcom={};findcom.parseReference=function(a){var b,c,d,e,f=-1,g=-1,h=-1,k=-1,l=-1,m=new String(a).replace("&ndash;","-").replace("\xE2\u20AC\u201C","-").replace(/(\d+[\.:])\s+(\d+)/gi,"$1$2"),n=null;for(b=m.length;0<=b;b--)if(/[A-Za-z]/.test(m.substring(b-1,b))){n=m.substring(0,b).toLowerCase();break}if(null!=n){for(0==n.indexOf("commentary on ")?n=n.slice(14):0==n.indexOf("commentaries on ")&&(n=n.slice(16)),b=0,d=bbooks.Books.length;b<d&&-1==f;b++)for(c=0,e=bbooks.Books[b].names.length;c<e;c++)if(name=new String(bbooks.Books[b].names[c]).toLowerCase(),n==name){f=b,m=m.substring(name.length);break}-1<f&&(params=findcom.parseScriptureRef(m,f),g=params.c1,k=params.c2,h=params.v1,l=params.v2)}return findcom.Reference(f,g,h,k,l)},findcom.parseScriptureRef=function(a,b){var c,d,e=-1,f=-1,g=-1,h=-1,j=!1,k=!1,l=!1,m="";for(c=0;c<a.length;c++)if(d=a.charAt(c)," "==d||isNaN(d)){if(!l)continue;"-"==d?(j=!0,k=!1):(":"==d||","==d)&&(k=!0),m="",l=!1}else l=!0,m+=d,k?j?h=parseInt(m,10):g=parseInt(m,10):j?f=parseInt(m,10):e=parseInt(m,10);return 1==bbooks.Books[b].verses.length&&0<e&&-1==g&&(g=e,e=1),0<e&&0<g&&0<f&&0>=h&&(h=f,f=e),0<e&&0>=g&&0<f&&0<h&&(g=1),-1<b&&0>=e&&0>=g&&0>=f&&0>=h&&(e=1),"undefined"!=typeof bbooks.Books[b].verses&&(-1==e?e=1:-1!=g&&e>bbooks.Books[b].verses.length&&(e=bbooks.Books[b].verses.length,0<g&&(g=1)),g>bbooks.Books[b].verses[e-1]&&(g=bbooks.Books[b].verses[e-1])),{c1:e,c2:f,v1:g,v2:h}},findcom.Reference=function(){var a=-1,b=-1,c=-1,d=-1,e=-1,f=arguments;if(0==f.length);else{if(1==f.length&&"string"==typeof f[0])return findcom.parseReference(f[0]);if(1==f.length)return null;a=f[0],b=f[1],3<=f.length&&(c=f[2]),4<=f.length&&(d=f[3]),5<=f.length&&(e=f[4])}return{bookIndex:a,chapter:b,verse:c,chapter1:b,verse1:c,chapter2:d,verse2:e,isValid:function(){return-1<a&&a<bbooks.Books.length&&0<b&&-1<c&&b<=bbooks.Chapters[a]},chapterAndVerse:function(a,b,c){a=a||":",b=b||"-",c=c||"-";var d=this.chapter1,e=this.chapter2,f=this.verse1,g=this.verse2,h=1==bbooks.Books[this.bookIndex].verses.length?"":d,i=""==h?"":a;return 0<d&&0>=f&&0>=e&&0>=g?h:0<d&&0<f&&0>=e&&0>=g?h+i+f:0<d&&0<f&&0>=e&&0<g?h+i+f+b+g:0<d&&0>=f&&0<e&&0>=g?d+c+e:0<d&&0<f&&0<e&&0<g?d+a+f+c+(d==e?"":e+a)+g:"?"},toString:function(){return 0>this.bookIndex||this.bookIndex>=bbooks.Books.length?"invalid":bbooks.Books[this.bookIndex].names[0]+" "+this.chapterAndVerse()},toShortUrl:function(){return 0>this.bookIndex||this.bookIndex>=bbooks.Books.length?"invalid":"/"+bbooks.Books[this.bookIndex].names[0].replace(" ","-")+"/"+this.chapter1+"/"+this.verse1},contextUrl:function(){return 0>this.bookIndex||this.bookIndex>=bbooks.Books.length?"invalid":"/"+bbooks.Books[this.bookIndex].names[0].replace(" ","-")+"/"+this.chapter1+(-1<this.verse1?"/nav"+this.verse1:"")+"/ct"}}},function(){var a=1e5,b={},c=function(c,e){var f="callback"+a++,g=j.createElement("script");i[f]=function(a){e(a)},b[c]=f,c+=(-1<c.indexOf("?")?"&":"?")+"callback="+f,g.setAttribute("src",c),g.setAttribute("type","text/javascript"),k.appendChild(g)},d=function(a,b){var d=new findcom.Reference(a);href=d.bookIndex+1+","+d.chapter1+","+d.verse1+","+d.chapter2+","+d.verse2,c(h.remoteURL+"/jsonverse.php?ref="+encodeURIComponent(href),b)},e=function(a){popp.content.innerHTML="<div>"+a.content+"</div>"},f=function(a,b){a.setAttribute("href",b.toShortUrl()),1==prfcommnewtab&&a.setAttribute("target","_blank"),a.setAttribute("title","Click to read commentary on "+b.toString()),a.setAttribute("rel",b.toString()),a.setAttribute("ver"," <span style=\"font-weight:normal;font-size:80%;\">(REV)</span>"),a.setAttribute("class",h.className),a.setAttribute("context","<span style=\"float:right;margin-right:-2px;\"><a href=\""+b.contextUrl()+"\" target=\"_blank\" title=\"view context (new window)\"><img src=\"/i/context.png\" style=\"width:1.1em;border:0\" /></a></span>"),x(a,"mouseover",g),x(a,"mouseout",pophandleLinkMouseOut)},g=function(a){if(a||(a=i.event),!!h.enablePopups){popclearPositionTimer();var b=a.target?a.target:a.srcElement,c=popp,f=b.getAttribute("rel"),g=b.getAttribute("ver");c.outer.style.display="block",c.outer.style.visibility="hidden",popdivShowTimer=setTimeout("popp.outer.style.visibility = 'visible';",300),c.header.innerHTML=f+g+b.getAttribute("context"),c.content.innerHTML="Loading...<br/><br/><br/>",poppositionPopup(b),d(f,function(a){e(a),poppositionPopup(b)})}},h={maxNodes:500,className:"findvers_reference",enablePopups:!0,autoStart:!0,startNodeId:"",ignoreClassName:"findvers_ignore",ignoreTags:["h1","h2","h3","h4"],newTagName:"A",remoteURL:"",handleLinks:f},i=window,j=document,k=null,l=bbooks.bbooks,m="(?:\\d{1,3}(?::\\d+)?)(?:-\\d+(?::\\d+)?)?",n="(?: ?, ?"+m+")|(?: ?(?:(?:(?:;|,)? and|;)) ?"+"(?:\\d{1,3}(?::\\d+))(?:-\\d+(?::\\d+)?)?"+")",o=new RegExp("\\b(?:(?:commentary|commentaries) on )(?:"+l+")\\.? (?:"+m+"(?:"+n+")*(?:(?:(?:;|,)? and|;) (?:"+l+")\\.? (?:"+m+"(?:"+n+")*))*)\\b","mi"),p=new RegExp(m,"mi"),q=["a","script","style","textarea"],r=null,s=function(a){var b,c,d,e,f=o.exec(a.data);return r=null,f?(b=f[0],c=a.splitText(f.index),d=c.splitText(b.length),e=t(a,c),e):a},t=function(a,b){if(null==b.nodeValue)return b;var c,d,e,f,g,i=b.nodeValue.indexOf(","),j=b.nodeValue.indexOf(";"),k=b.nodeValue.indexOf(" and"),l=b.nodeValue.indexOf(", and"),m=b.nodeValue.indexOf("; and");if(c=Math.min(0>i?999:i,0>j?999:j,0>k?999:k,0>l?999:l,0>m?999:m),999==c&&(c=-1),0<c){switch(d=b.splitText(c),d.nodeValue.substring(0,3)){case"and":g=4;break;case" an":g=5;break;case", a":g=6;break;case"; a":g=6;break;default:g=1;}for(;g<d.nodeValue.length&&" "==d.nodeValue.substring(g,g+1);)g++;e=d.splitText(g)}return refText=b.nodeValue,f=u(refText),"undefined"!=typeof f&&f.isValid()?(newNode=a.ownerDocument.createElement(h.newTagName),a.parentNode.replaceChild(newNode,b),h.handleLinks(newNode,f),newNode.appendChild(b),e&&(newNode=t(a,e)),newNode):b},u=function(a){var b,c,d,e,f=new findcom.Reference(a),g=null;return null!=f&&"undefined"!=typeof f.isValid&&f.isValid()?(r=f,f):null==r?void 0:(g=p.exec(a),g?(input=g[0],params=findcom.parseScriptureRef(input,r.bookIndex),b=params.c1,c=params.v1,d=params.c2,e=params.v2,0<b&&0>c&&0>d&&0>e?(r.verse1=b,r.chapter2=-1,r.verse2=-1):0<b&&0<c&&0>d&&0>e?(r.chapter1=b,r.verse1=c,r.chapter2=-1,r.verse2=-1):0<b&&0>c&&0<d&&0>e?(r.verse1=b,r.chapter2=-1,r.verse2=d):0<b&&0<c&&0>d&&0<e?(r.chapter1=b,r.verse1=c,r.chapter2=-1,r.verse2=e):0<b&&0<c&&0<d&&0<e&&(r.chapter1=b,r.verse1=c,r.chapter2=d,r.verse2=e),r):"javascript:null")},v=function(a){w(a.childNodes[0],1,s)},w=function(a,b,c){for(var d=0,e=new RegExp("^("+q.concat(h.ignoreTags).join("|")+")$","i");a&&0<b;){if(d++,d>=h.maxNodes)return void setTimeout(function(){w(a,b,c)},50);switch(a.nodeType){case 1:if(!e.test(a.tagName.toLowerCase())&&0<a.childNodes.length&&(""==h.ignoreClassName||-1==a.className.toString().indexOf(h.ignoreClassName))){a=a.childNodes[0],b++;continue}break;case 3:case 4:a=c(a);}if(a.nextSibling)a=a.nextSibling;else for(;0<b;)if(a=a.parentNode,b--,a.nextSibling){a=a.nextSibling;break}}},x=function(a,b,c){if(a.attachEvent)a.attachEvent("on"+b,c);else if(a.addEventListener)a.addEventListener(b,c,!1);else{var d=a["on"+b];a["on"+b]=function(){c(),d()}}},y=!1,z=function(){y||(y=!0,j=document,k=j.body,""!=h.startNodeId&&(node=j.getElementById(h.startNodeId)),null==node&&(node=k),v(node),y=!1)};"undefined"!=typeof window.findcomm&&(h=function(){var a,b,c,d,e=arguments[0]||{},f=1,g=arguments.length;for("object"!=typeof e&&"function"!=typeof e&&(e={});f<g;f++)if(null!=(a=arguments[f]))for(b in a)(c=e[b],d=a[b],e!==d)&&void 0!==d&&(e[b]=d);return e}(h,window.findcomm)),h.scan=z,h.scanForReferences=v,i.findcomm=h}();
